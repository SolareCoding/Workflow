import * as React from "react";
import { useContext, useEffect, useState } from "react";
import NodeView from "../nodes/Node.view";
import { Stack, Typography } from "@mui/material";
import { NodeStatusEnum } from "../nodes/NodeStatus.enum";
import Box from "@mui/material/Box";
import { NodeModel } from "../nodes/Node.model";
import { AddCircle } from "@mui/icons-material";
import { WorkPanelContext } from "../workpanel/WorkPanel.view";
import { UpdateMode } from "../workpanel/WorkPanel.controller";
import DeleteIcon from "@mui/icons-material/Delete";
/**
 * A section in the pipeline contains multiple nodes.
 * It manages the name, delete of the section.
 * And it provides the entrance to add new nodes.
 */
export default function SectionView(props) {
    const { pipeline, section, couldUpdate, editorMode } = props;
    const nodes = section.nodes;
    const [title, setTitle] = useState(section.title);
    const workPanelController = useContext(WorkPanelContext);
    const isPending = (node) => node.status == NodeStatusEnum.PENDING;
    const isDone = (node) => node.status == NodeStatusEnum.DONE;
    const getSectionStatus = () => {
        if (nodes.every(isPending)) {
            return NodeStatusEnum.PENDING;
        }
        else if (nodes.every(isDone)) {
            return NodeStatusEnum.DONE;
        }
        else {
            return NodeStatusEnum.WORKING;
        }
    };
    useEffect(() => {
        if (section.status == getSectionStatus()) {
            return;
        }
        workPanelController.updateSection(pipeline, Object.assign({}, section, { status: getSectionStatus() }));
    }, [section]);
    const onRemoveSection = () => {
        workPanelController.updateSection(pipeline, section, UpdateMode.DELETE);
    };
    const onInsertNewNode = (index) => {
        props.section.nodes.splice(index, 0, NodeModel.newInstance());
        const newSection = Object.assign({}, section, { nodes: props.section.nodes });
        workPanelController.updateSection(pipeline, newSection, UpdateMode.UPDATE);
    };
    const handleSectionNameChange = (event) => {
        setTitle(event.target.value);
        props.section.title = event.target.value;
        const newSection = Object.assign({}, section, { title: event.target.value });
        workPanelController.updateSection(pipeline, newSection);
    };
    const getSectionTitleView = () => {
        if (!editorMode) {
            return React.createElement(Typography, { sx: { fontSize: 16, width: 150, fontWeight: 600 } }, section.title);
        }
        else {
            return React.createElement("input", { className: 'workflow-input', style: { fontSize: 16, width: 150, fontWeight: 600 }, id: "template-simple", value: title, onChange: handleSectionNameChange });
        }
    };
    const getActionView = () => {
        if (!editorMode) {
            return null;
        }
        return React.createElement(Box, { onClick: () => onRemoveSection() },
            React.createElement(DeleteIcon, null));
    };
    const getAddNodeView = (index) => {
        if (!editorMode)
            return null;
        return React.createElement(Box, { key: 'addNode-' + index, onClick: () => {
                onInsertNewNode(index);
            } },
            React.createElement(AddCircle, null));
    };
    const getNodeViews = () => {
        let nodeViews = [];
        const nodeKey = editorMode ? 'editorNode-' : 'node-';
        nodeViews.push(getAddNodeView(0));
        for (let i = 0; i < nodes.length; i++) {
            nodeViews.push(React.createElement(NodeView, { key: nodeKey + nodes[i].id, pipeline: pipeline, section: section, node: nodes[i], couldUpdate: couldUpdate, editorMode: editorMode }));
            nodeViews.push(getAddNodeView(i + 1));
        }
        return nodeViews;
    };
    return (React.createElement(Box, { className: 'workflow-container-outer', sx: { display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'space-between', padding: 1, borderRadius: 1 } },
        React.createElement(Box, { sx: {
                width: 180,
                display: 'flex',
                flexDirection: 'row',
                alignItems: 'center',
                justifyContent: 'space-between',
                marginBottom: 1,
            } },
            getSectionTitleView(),
            getActionView()),
        React.createElement(Stack, { spacing: 1, sx: { alignItems: 'center' } }, getNodeViews())));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VjdGlvbi52aWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU2VjdGlvbi52aWV3LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLEVBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUMsTUFBTSxPQUFPLENBQUM7QUFDdEQsT0FBTyxRQUFRLE1BQU0sb0JBQW9CLENBQUM7QUFDMUMsT0FBTyxFQUFDLEtBQUssRUFBRSxVQUFVLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFaEQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQ3hELE9BQU8sR0FBRyxNQUFNLG1CQUFtQixDQUFDO0FBQ3BDLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUM5QyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDOUMsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sNkJBQTZCLENBQUM7QUFDN0QsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLG1DQUFtQyxDQUFDO0FBQzdELE9BQU8sVUFBVSxNQUFNLDRCQUE0QixDQUFDO0FBVXBEOzs7O0dBSUc7QUFDSCxNQUFNLENBQUMsT0FBTyxVQUFVLFdBQVcsQ0FBQyxLQUFtQjtJQUV0RCxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFDLEdBQUcsS0FBSyxDQUFBO0lBQzNELE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUE7SUFFM0IsTUFBTSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ2pELE1BQU0sbUJBQW1CLEdBQUcsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUE7SUFFeEQsTUFBTSxTQUFTLEdBQUcsQ0FBQyxJQUFlLEVBQUUs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aEIsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFDZCxXQUFXLEVBQUUsV0FBVyxFQUN4QixVQUFVLEVBQUUsVUFBVSxHQUFJLENBQUMsQ0FBQTtZQUNsQyxTQUFTLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUNyQztRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ2xCLENBQUMsQ0FBQTtJQUVELE9BQU8sQ0FDTixvQkFBQyxHQUFHLElBQUMsU0FBUyxFQUFFLDBCQUEwQixFQUFFLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxZQUFZLEVBQUUsQ0FBQyxFQUFDO1FBQzlLLG9CQUFDLEdBQUcsSUFBQyxFQUFFLEVBQUU7Z0JBQ1IsS0FBSyxFQUFFLEdBQUc7Z0JBQ1YsT0FBTyxFQUFFLE1BQU07Z0JBQ2YsYUFBYSxFQUFFLEtBQUs7Z0JBQ3BCLFVBQVUsRUFBRSxRQUFRO2dCQUNwQixjQUFjLEVBQUUsZUFBZTtnQkFDL0IsWUFBWSxFQUFFLENBQUM7YUFDZjtZQUNDLG1CQUFtQixFQUFFO1lBQ3JCLGFBQWEsRUFBRSxDQUNYO1FBQ04sb0JBQUMsS0FBSyxJQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUMsVUFBVSxFQUFFLFFBQVEsRUFBQyxJQUMzQyxZQUFZLEVBQUUsQ0FDUixDQUNILENBQ04sQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tIFwicmVhY3RcIjtcclxuaW1wb3J0IHt1c2VDb250ZXh0LCB1c2VFZmZlY3QsIHVzZVN0YXRlfSBmcm9tIFwicmVhY3RcIjtcclxuaW1wb3J0IE5vZGVWaWV3IGZyb20gXCIuLi9ub2Rlcy9Ob2RlLnZpZXdcIjtcclxuaW1wb3J0IHtTdGFjaywgVHlwb2dyYXBoeX0gZnJvbSBcIkBtdWkvbWF0ZXJpYWxcIjtcclxuaW1wb3J0IHtQaXBlbGluZU1vZGVsLCBTZWN0aW9uTW9kZWx9IGZyb20gXCIuL1BpcGVsaW5lLm1vZGVsXCI7XHJcbmltcG9ydCB7Tm9kZVN0YXR1c0VudW19IGZyb20gXCIuLi9ub2Rlcy9Ob2RlU3RhdHVzLmVudW1cIjtcclxuaW1wb3J0IEJveCBmcm9tIFwiQG11aS9tYXRlcmlhbC9Cb3hcIjtcclxuaW1wb3J0IHtOb2RlTW9kZWx9IGZyb20gXCIuLi9ub2Rlcy9Ob2RlLm1vZGVsXCI7XHJcbmltcG9ydCB7QWRkQ2lyY2xlfSBmcm9tIFwiQG11aS9pY29ucy1tYXRlcmlhbFwiO1xyXG5pbXBvcnQge1dvcmtQYW5lbENvbnRleHR9IGZyb20gXCIuLi93b3JrcGFuZWwvV29ya1BhbmVsLnZpZXdcIjtcclxuaW1wb3J0IHtVcGRhdGVNb2RlfSBmcm9tIFwiLi4vd29ya3BhbmVsL1dvcmtQYW5lbC5jb250cm9sbGVyXCI7XHJcbmltcG9ydCBEZWxldGVJY29uIGZyb20gXCJAbXVpL2ljb25zLW1hdGVyaWFsL0RlbGV0ZVwiO1xyXG5cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2VjdGlvblByb3BzIHtcclxuXHRwaXBlbGluZTogUGlwZWxpbmVNb2RlbFxyXG5cdHNlY3Rpb246IFNlY3Rpb25Nb2RlbFxyXG5cdGNvdWxkVXBkYXRlOiBib29sZWFuXHJcblx0ZWRpdG9yTW9kZT86IGJvb2xlYW5cclxufVxyXG5cclxuLyoqXHJcbiAqIEEgc2VjdGlvbiBpbiB0aGUgcGlwZWxpbmUgY29udGFpbnMgbXVsdGlwbGUgbm9kZXMuXHJcbiAqIEl0IG1hbmFnZXMgdGhlIG5hbWUsIGRlbGV0ZSBvZiB0aGUgc2VjdGlvbi5cclxuICogQW5kIGl0IHByb3ZpZGVzIHRoZSBlbnRyYW5jZSB0byBhZGQgbmV3IG5vZGVzLlxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gU2VjdGlvblZpZXcocHJvcHM6IFNlY3Rpb25Qcm9wcykge1xyXG5cclxuXHRjb25zdCB7IHBpcGVsaW5lLCBzZWN0aW9uLCBjb3VsZFVwZGF0ZSwgZWRpdG9yTW9kZX0gPSBwcm9wc1xyXG5cdGNvbnN0IG5vZGVzID0gc2VjdGlvbi5ub2Rlc1xyXG5cclxuXHRjb25zdCBbdGl0bGUsIHNldFRpdGxlXSA9IHVzZVN0YXRlKHNlY3Rpb24udGl0bGUpXHJcblx0Y29uc3Qgd29ya1BhbmVsQ29udHJvbGxlciA9IHVzZUNvbnRleHQoV29ya1BhbmVsQ29udGV4dClcclxuXHJcblx0Y29uc3QgaXNQZW5kaW5nID0gKG5vZGU6IE5vZGVNb2RlbCkgPT4gbm9kZS5zdGF0dXMgPT0gTm9kZVN0YXR1c0VudW0uUEVORElOR1xyXG5cdGNvbnN0IGlzRG9uZSA9IChub2RlOiBOb2RlTW9kZWwpID0+IG5vZGUuc3RhdHVzID09IE5vZGVTdGF0dXNFbnVtLkRPTkVcclxuXHJcblx0Y29uc3QgZ2V0U2VjdGlvblN0YXR1cyA9ICgpID0+IHtcclxuXHRcdGlmIChub2Rlcy5ldmVyeShpc1BlbmRpbmcpKSB7XHJcblx0XHRcdHJldHVybiBOb2RlU3RhdHVzRW51bS5QRU5ESU5HXHJcblx0XHR9IGVsc2UgaWYgKG5vZGVzLmV2ZXJ5KGlzRG9uZSkpIHtcclxuXHRcdFx0cmV0dXJuIE5vZGVTdGF0dXNFbnVtLkRPTkVcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHJldHVybiBOb2RlU3RhdHVzRW51bS5XT1JLSU5HXHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHR1c2VFZmZlY3QoKCkgPT4ge1xyXG5cdFx0aWYgKHNlY3Rpb24uc3RhdHVzID09IGdldFNlY3Rpb25TdGF0dXMoKSkge1xyXG5cdFx0XHRyZXR1cm5cclxuXHRcdH1cclxuXHRcdHdvcmtQYW5lbENvbnRyb2xsZXIudXBkYXRlU2VjdGlvbihwaXBlbGluZSwgT2JqZWN0LmFzc2lnbih7fSwgc2VjdGlvbiwge3N0YXR1czogZ2V0U2VjdGlvblN0YXR1cygpfSkpXHJcblx0fSwgW3NlY3Rpb25dKVxyXG5cclxuXHRjb25zdCBvblJlbW92ZVNlY3Rpb24gPSAoKSA9PiB7XHJcblx0XHR3b3JrUGFuZWxDb250cm9sbGVyLnVwZGF0ZVNlY3Rpb24ocGlwZWxpbmUsIHNlY3Rpb24sIFVwZGF0ZU1vZGUuREVMRVRFKVxyXG5cdH1cclxuXHJcblx0Y29uc3Qgb25JbnNlcnROZXdOb2RlID0gKGluZGV4OiBudW1iZXIpID0+IHtcclxuXHRcdHByb3BzLnNlY3Rpb24ubm9kZXMuc3BsaWNlKGluZGV4LCAwLCBOb2RlTW9kZWwubmV3SW5zdGFuY2UoKSlcclxuXHRcdGNvbnN0IG5ld1NlY3Rpb24gPSBPYmplY3QuYXNzaWduKHt9LCBzZWN0aW9uLCB7bm9kZXM6IHByb3BzLnNlY3Rpb24ubm9kZXN9KVxyXG5cdFx0d29ya1BhbmVsQ29udHJvbGxlci51cGRhdGVTZWN0aW9uKHBpcGVsaW5lLCBuZXdTZWN0aW9uLCBVcGRhdGVNb2RlLlVQREFURSlcclxuXHR9XHJcblxyXG5cdGNvbnN0IGhhbmRsZVNlY3Rpb25OYW1lQ2hhbmdlID0gKGV2ZW50OiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xyXG5cdFx0c2V0VGl0bGUoZXZlbnQudGFyZ2V0LnZhbHVlKVxyXG5cdFx0cHJvcHMuc2VjdGlvbi50aXRsZSA9IGV2ZW50LnRhcmdldC52YWx1ZVxyXG5cdFx0Y29uc3QgbmV3U2VjdGlvbiA9IE9iamVjdC5hc3NpZ24oe30sIHNlY3Rpb24sIHt0aXRsZTogZXZlbnQudGFyZ2V0LnZhbHVlfSlcclxuXHRcdHdvcmtQYW5lbENvbnRyb2xsZXIudXBkYXRlU2VjdGlvbihwaXBlbGluZSwgbmV3U2VjdGlvbilcclxuXHR9O1xyXG5cclxuXHRjb25zdCBnZXRTZWN0aW9uVGl0bGVWaWV3ID0gKCkgPT4ge1xyXG5cdFx0aWYgKCFlZGl0b3JNb2RlKSB7XHJcblx0XHRcdHJldHVybiA8VHlwb2dyYXBoeSBzeD17e2ZvbnRTaXplOiAxNiwgd2lkdGg6IDE1MCwgZm9udFdlaWdodDogNjAwfX0+e3NlY3Rpb24udGl0bGV9PC9UeXBvZ3JhcGh5PlxyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cmV0dXJuIDxpbnB1dCBjbGFzc05hbWU9eyd3b3JrZmxvdy1pbnB1dCd9IHN0eWxlPXt7Zm9udFNpemU6IDE2LCB3aWR0aDogMTUwLCBmb250V2VpZ2h0OiA2MDB9fSBpZD1cInRlbXBsYXRlLXNpbXBsZVwiIHZhbHVlPXt0aXRsZX0gb25DaGFuZ2U9e2hhbmRsZVNlY3Rpb25OYW1lQ2hhbmdlfSAvPlxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Y29uc3QgZ2V0QWN0aW9uVmlldyA9ICgpID0+IHtcclxuXHRcdGlmICghZWRpdG9yTW9kZSkge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdHJldHVybiA8Qm94IG9uQ2xpY2s9eygpID0+IG9uUmVtb3ZlU2VjdGlvbigpfT5cclxuXHRcdFx0PERlbGV0ZUljb24vPlxyXG5cdFx0PC9Cb3g+XHJcblx0fVxyXG5cclxuXHRjb25zdCBnZXRBZGROb2RlVmlldyA9IChpbmRleDogbnVtYmVyKSA9PiB7XHJcblx0XHRpZiAoIWVkaXRvck1vZGUpIHJldHVybiBudWxsXHJcblx0XHRyZXR1cm4gPEJveCBrZXk9eydhZGROb2RlLScgKyBpbmRleH0gb25DbGljaz17KCkgPT4ge1xyXG5cdFx0XHRvbkluc2VydE5ld05vZGUoaW5kZXgpXHJcblx0XHR9fT5cclxuXHRcdFx0PEFkZENpcmNsZS8+XHJcblx0XHQ8L0JveD5cclxuXHR9XHJcblxyXG5cdGNvbnN0IGdldE5vZGVWaWV3cyA9ICgpID0+IHtcclxuXHRcdGxldCBub2RlVmlld3MgPSBbXVxyXG5cdFx0Y29uc3Qgbm9kZUtleSA9IGVkaXRvck1vZGUgPyAnZWRpdG9yTm9kZS0nIDogJ25vZGUtJztcclxuXHRcdG5vZGVWaWV3cy5wdXNoKGdldEFkZE5vZGVWaWV3KDApKVxyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPG5vZGVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdG5vZGVWaWV3cy5wdXNoKDxOb2RlVmlldyBrZXk9e25vZGVLZXkgKyBub2Rlc1tpXS5pZH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0IHBpcGVsaW5lPXtwaXBlbGluZX1cclxuXHRcdFx0XHRcdFx0XHRcdFx0IHNlY3Rpb249e3NlY3Rpb259XHJcblx0XHRcdFx0XHRcdFx0XHRcdCBub2RlPXtub2Rlc1tpXX1cclxuXHRcdFx0XHRcdFx0XHRcdFx0IGNvdWxkVXBkYXRlPXtjb3VsZFVwZGF0ZX1cclxuXHRcdFx0XHRcdFx0XHRcdFx0IGVkaXRvck1vZGU9e2VkaXRvck1vZGV9IC8+KVxyXG5cdFx0XHRub2RlVmlld3MucHVzaChnZXRBZGROb2RlVmlldyhpICsgMSkpXHJcblx0XHR9XHJcblx0XHRyZXR1cm4gbm9kZVZpZXdzO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIChcclxuXHRcdDxCb3ggY2xhc3NOYW1lPXsnd29ya2Zsb3ctY29udGFpbmVyLW91dGVyJ30gc3g9e3sgZGlzcGxheTogJ2ZsZXgnLCBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywgYWxpZ25JdGVtczogJ2NlbnRlcicsIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicsIHBhZGRpbmc6IDEsIGJvcmRlclJhZGl1czogMX19PlxyXG5cdFx0XHQ8Qm94IHN4PXt7XHJcblx0XHRcdFx0d2lkdGg6IDE4MCxcclxuXHRcdFx0XHRkaXNwbGF5OiAnZmxleCcsXHJcblx0XHRcdFx0ZmxleERpcmVjdGlvbjogJ3JvdycsXHJcblx0XHRcdFx0YWxpZ25JdGVtczogJ2NlbnRlcicsXHJcblx0XHRcdFx0anVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1iZXR3ZWVuJyxcclxuXHRcdFx0XHRtYXJnaW5Cb3R0b206IDEsXHJcblx0XHRcdH19PlxyXG5cdFx0XHRcdHtnZXRTZWN0aW9uVGl0bGVWaWV3KCl9XHJcblx0XHRcdFx0e2dldEFjdGlvblZpZXcoKX1cclxuXHRcdFx0PC9Cb3g+XHJcblx0XHRcdDxTdGFjayBzcGFjaW5nPXsxfSBzeD17e2FsaWduSXRlbXM6ICdjZW50ZXInfX0+XHJcblx0XHRcdFx0e2dldE5vZGVWaWV3cygpfVxyXG5cdFx0XHQ8L1N0YWNrPlxyXG5cdFx0PC9Cb3g+XHJcblx0KTtcclxufVxyXG4iXX0=