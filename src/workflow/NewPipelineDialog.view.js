import * as React from 'react';
import { useEffect } from 'react';
import DialogTitle from '@mui/material/DialogTitle';
import Dialog from '@mui/material/Dialog';
import { NodeStatusEnum } from "../nodes/NodeStatus.enum";
import { FormControl, InputLabel, MenuItem } from "@mui/material";
import Select from '@mui/material/Select';
import UUIDUtils from "../utils/UUID.utils";
export default function NewPipelineDialog(props) {
    const { closeDialog, templates, open, subjects, preSelectedTemplate, preSetWorkflowName } = props;
    const [templateIndex, setTemplateIndex] = React.useState('');
    const [subjectIndex, setSubjectIndex] = React.useState('');
    const [taskName, setTaskName] = React.useState('新任务');
    useEffect(() => {
        setTaskName('新任务');
    }, [open]);
    useEffect(() => {
        if (!preSelectedTemplate || !preSetWorkflowName) {
            return;
        }
        const templateIndex = templates.indexOf(preSelectedTemplate);
        setTemplateIndex(templateIndex.toString());
        setTaskName(preSetWorkflowName);
    }, [preSelectedTemplate, templates, preSetWorkflowName]);
    const handleCreateNew = () => {
        if (templateIndex === '') {
            return;
        }
        const template = templates[Number.parseInt(templateIndex)];
        const subject = subjects[Number.parseInt(subjectIndex)];
        // deep copy template and modify uuid
        const copiedSections = [];
        for (const section of template.sections) {
            const copiedSection = Object.assign({}, section);
            copiedSection.id = UUIDUtils.getUUID();
            const copiedNodes = [];
            for (const node of copiedSection.nodes) {
                const copiedNode = Object.assign({}, node);
                copiedNode.id = UUIDUtils.getUUID();
                copiedNodes.push(copiedNode);
            }
            copiedSection.nodes = copiedNodes;
            copiedSections.push(copiedSection);
        }
        const copiedPipeline = {
            templateTitle: template.title,
            title: taskName,
            createTime: Date.now(),
            status: NodeStatusEnum.PENDING,
            isTemplate: false,
            id: UUIDUtils.getUUID(),
            subjectID: (subject === null || subject === void 0 ? void 0 : subject.id) || '0',
            sections: copiedSections
        };
        props.createNewTask(copiedPipeline);
    };
    const getTemplateViews = () => {
        let pipelines = [];
        for (let i = 0; i < templates.length; i++) {
            let pipeline = templates[i];
            pipelines.push(React.createElement(MenuItem, { key: 'template-' + pipeline.id, sx: { color: 'var(--text-normal)', fontSize: '13px' }, value: i }, pipeline.title));
        }
        return pipelines;
    };
    const handleTemplateChange = (event) => {
        setTemplateIndex(event.target.value);
    };
    const getSubjectViews = () => {
        let subjectsViews = [];
        for (let i = 0; i < subjects.length; i++) {
            let subject = subjects[i];
            subjectsViews.push(React.createElement(MenuItem, { key: 'subject-' + subject.id, sx: { color: 'var(--text-normal)', fontSize: '13px' }, value: i }, subject.name));
        }
        return subjectsViews;
    };
    const handleSubjectChange = (event) => {
        setSubjectIndex(event.target.value);
    };
    const handleTaskNameChange = (event) => {
        setTaskName(event.target.value);
    };
    return (React.createElement(Dialog, { onClose: closeDialog, open: open, PaperProps: {
            style: {
                backgroundColor: 'var(--background-secondary)',
                boxShadow: 'none',
                color: 'var(--text-normal)'
            },
        } },
        React.createElement(DialogTitle, { className: 'workflow-text-normal' }, "Create a new pipeline"),
        React.createElement(FormControl, { variant: "standard", sx: { margin: 1 } },
            React.createElement(InputLabel, { id: "template-select-label", sx: { color: 'var(--text-normal)' } }, "Select template"),
            React.createElement(Select, { style: {
                    color: 'var(--text-normal)',
                    fontSize: '13px'
                }, MenuProps: { PaperProps: {
                        sx: {
                            backgroundColor: 'var(--background-secondary)',
                            color: '#FFFFFF',
                        },
                    },
                }, id: "template-select", value: templateIndex, onChange: handleTemplateChange }, getTemplateViews())),
        React.createElement(FormControl, { variant: "standard", sx: { margin: 1 } },
            React.createElement(InputLabel, { id: "subject-select-label", sx: { color: 'var(--text-normal)' } }, "Select subject"),
            React.createElement(Select, { style: {
                    color: 'var(--text-normal)',
                    fontSize: '13px'
                }, MenuProps: { PaperProps: {
                        sx: {
                            backgroundColor: 'var(--background-secondary)',
                            color: '#FFFFFF',
                        },
                    },
                }, id: "subject-select", value: subjectIndex, onChange: handleSubjectChange }, getSubjectViews())),
        React.createElement(FormControl, { variant: "standard", sx: { margin: 1 } },
            React.createElement("input", { className: 'workflow-input', style: { fontSize: '13px' }, id: "template-simple", value: taskName, onChange: handleTaskNameChange }),
            React.createElement("button", { style: { marginTop: 10 }, onClick: () => {
                    handleCreateNew();
                }, disabled: templateIndex === '' }, "OK!"))));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV3UGlwZWxpbmVEaWFsb2cudmlldy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk5ld1BpcGVsaW5lRGlhbG9nLnZpZXcudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxPQUFPLENBQUM7QUFDaEMsT0FBTyxXQUFXLE1BQU0sMkJBQTJCLENBQUM7QUFDcEQsT0FBTyxNQUFNLE1BQU0sc0JBQXNCLENBQUM7QUFFMUMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBQ3hELE9BQU8sRUFBQyxXQUFXLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNoRSxPQUFPLE1BQTJCLE1BQU0sc0JBQXNCLENBQUM7QUFDL0QsT0FBTyxTQUFTLE1BQU0scUJBQXFCLENBQUM7QUFhNUMsTUFBTSxDQUFDLE9BQU8sVUFBVSxpQkFBaUIsQ0FBQyxLQUF1QjtJQUVoRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLG1CQUFtQixFQUFFLGtCQUFrQixFQUFFLEdBQUcsS0FBSyxDQUFDO0lBQ2xHLE1BQU0sQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzdELE1BQU0sQ0FBQyxZQUFZLEVBQUUsZUFBZSxDQUFDLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUMzRCxNQUFNLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUE7SUFFckQsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNkLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUNuQixDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FB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aEI7cUJBQUU7aUJBQ0osRUFDRCxFQUFFLEVBQUMsZ0JBQWdCLEVBQ25CLEtBQUssRUFBRSxZQUFZLEVBQ25CLFFBQVEsRUFBRSxtQkFBbUIsSUFFNUIsZUFBZSxFQUFFLENBQ1YsQ0FDSTtRQUNkLG9CQUFDLFdBQVcsSUFBQyxPQUFPLEVBQUMsVUFBVSxFQUFDLEVBQUUsRUFBRSxFQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUM7WUFDN0MsK0JBQU8sU0FBUyxFQUFFLGdCQUFnQixFQUFFLEtBQUssRUFBRSxFQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUMsRUFBRSxFQUFFLEVBQUMsaUJBQWlCLEVBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsb0JBQW9CLEdBQUk7WUFDdkksZ0NBQ0MsS0FBSyxFQUFFLEVBQUMsU0FBUyxFQUFFLEVBQUUsRUFBQyxFQUN0QixPQUFPLEVBQUUsR0FBRyxFQUFFO29CQUNiLGVBQWUsRUFBRSxDQUFBO2dCQUNsQixDQUFDLEVBQ0QsUUFBUSxFQUFHLGFBQWEsS0FBSyxFQUFFLFVBR3ZCLENBQ0ksQ0FDTixDQUNULENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQge3VzZUVmZmVjdH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgRGlhbG9nVGl0bGUgZnJvbSAnQG11aS9tYXRlcmlhbC9EaWFsb2dUaXRsZSc7XHJcbmltcG9ydCBEaWFsb2cgZnJvbSAnQG11aS9tYXRlcmlhbC9EaWFsb2cnO1xyXG5pbXBvcnQge1BpcGVsaW5lTW9kZWx9IGZyb20gXCIuLi9waXBlbGluZS9QaXBlbGluZS5tb2RlbFwiO1xyXG5pbXBvcnQge05vZGVTdGF0dXNFbnVtfSBmcm9tIFwiLi4vbm9kZXMvTm9kZVN0YXR1cy5lbnVtXCI7XHJcbmltcG9ydCB7Rm9ybUNvbnRyb2wsIElucHV0TGFiZWwsIE1lbnVJdGVtfSBmcm9tIFwiQG11aS9tYXRlcmlhbFwiO1xyXG5pbXBvcnQgU2VsZWN0LCB7U2VsZWN0Q2hhbmdlRXZlbnR9IGZyb20gJ0BtdWkvbWF0ZXJpYWwvU2VsZWN0JztcclxuaW1wb3J0IFVVSURVdGlscyBmcm9tIFwiLi4vdXRpbHMvVVVJRC51dGlsc1wiO1xyXG5pbXBvcnQge1N1YmplY3RNb2RlbH0gZnJvbSBcIi4uL3N1YmplY3QvU3ViamVjdC5tb2RlbFwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBOZXdQaXBlbGluZVByb3BzIHtcclxuXHRvcGVuOiBib29sZWFuO1xyXG5cdHRlbXBsYXRlczogUGlwZWxpbmVNb2RlbFtdO1xyXG5cdHN1YmplY3RzOiBTdWJqZWN0TW9kZWxbXTtcclxuXHRjbG9zZURpYWxvZzogKCkgPT4gdm9pZDtcclxuXHRjcmVhdGVOZXdUYXNrOiAobmV3UGlwZWxpbmU6IFBpcGVsaW5lTW9kZWwpID0+IHZvaWQ7XHJcblx0cHJlU2VsZWN0ZWRUZW1wbGF0ZT86IFBpcGVsaW5lTW9kZWwgfCBudWxsO1xyXG5cdHByZVNldFdvcmtmbG93TmFtZT86IHN0cmluZyB8IG51bGxcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gTmV3UGlwZWxpbmVEaWFsb2cocHJvcHM6IE5ld1BpcGVsaW5lUHJvcHMpIHtcclxuXHJcblx0Y29uc3QgeyBjbG9zZURpYWxvZywgdGVtcGxhdGVzLCBvcGVuLCBzdWJqZWN0cywgcHJlU2VsZWN0ZWRUZW1wbGF0ZSwgcHJlU2V0V29ya2Zsb3dOYW1lIH0gPSBwcm9wcztcclxuXHRjb25zdCBbdGVtcGxhdGVJbmRleCwgc2V0VGVtcGxhdGVJbmRleF0gPSBSZWFjdC51c2VTdGF0ZSgnJyk7XHJcblx0Y29uc3QgW3N1YmplY3RJbmRleCwgc2V0U3ViamVjdEluZGV4XSA9IFJlYWN0LnVzZVN0YXRlKCcnKTtcclxuXHRjb25zdCBbdGFza05hbWUsIHNldFRhc2tOYW1lXSA9IFJlYWN0LnVzZVN0YXRlKCfmlrDku7vliqEnKVxyXG5cclxuXHR1c2VFZmZlY3QoKCkgPT4ge1xyXG5cdFx0c2V0VGFza05hbWUoJ+aWsOS7u+WKoScpXHJcblx0fSwgW29wZW5dKVxyXG5cclxuXHR1c2VFZmZlY3QoKCkgPT4ge1xyXG5cdFx0aWYgKCFwcmVTZWxlY3RlZFRlbXBsYXRlIHx8ICFwcmVTZXRXb3JrZmxvd05hbWUpIHtcclxuXHRcdFx0cmV0dXJuXHJcblx0XHR9XHJcblx0XHRjb25zdCB0ZW1wbGF0ZUluZGV4ID0gdGVtcGxhdGVzLmluZGV4T2YocHJlU2VsZWN0ZWRUZW1wbGF0ZSlcclxuXHRcdHNldFRlbXBsYXRlSW5kZXgodGVtcGxhdGVJbmRleC50b1N0cmluZygpKVxyXG5cdFx0c2V0VGFza05hbWUocHJlU2V0V29ya2Zsb3dOYW1lKVxyXG5cdH0sIFtwcmVTZWxlY3RlZFRlbXBsYXRlLCB0ZW1wbGF0ZXMsIHByZVNldFdvcmtmbG93TmFtZV0pXHJcblxyXG5cdGNvbnN0IGhhbmRsZUNyZWF0ZU5ldyA9ICgpID0+IHtcclxuXHRcdGlmICh0ZW1wbGF0ZUluZGV4ID09PSAnJykge1xyXG5cdFx0XHRyZXR1cm5cclxuXHRcdH1cclxuXHRcdGNvbnN0IHRlbXBsYXRlID0gdGVtcGxhdGVzW051bWJlci5wYXJzZUludCh0ZW1wbGF0ZUluZGV4KV1cclxuXHRcdGNvbnN0IHN1YmplY3QgPSBzdWJqZWN0c1tOdW1iZXIucGFyc2VJbnQoc3ViamVjdEluZGV4KV1cclxuXHRcdC8vIGRlZXAgY29weSB0ZW1wbGF0ZSBhbmQgbW9kaWZ5IHV1aWRcclxuXHRcdGNvbnN0IGNvcGllZFNlY3Rpb25zID0gW11cclxuXHRcdGZvciAoY29uc3Qgc2VjdGlvbiBvZiB0ZW1wbGF0ZS5zZWN0aW9ucykge1xyXG5cdFx0XHRjb25zdCBjb3BpZWRTZWN0aW9uID0gT2JqZWN0LmFzc2lnbih7fSwgc2VjdGlvbilcclxuXHRcdFx0Y29waWVkU2VjdGlvbi5pZCA9IFVVSURVdGlscy5nZXRVVUlEKClcclxuXHRcdFx0Y29uc3QgY29waWVkTm9kZXMgPSBbXVxyXG5cdFx0XHRmb3IgKGNvbnN0IG5vZGUgb2YgY29waWVkU2VjdGlvbi5ub2Rlcykge1xyXG5cdFx0XHRcdGNvbnN0IGNvcGllZE5vZGUgPSBPYmplY3QuYXNzaWduKHt9LCBub2RlKVxyXG5cdFx0XHRcdGNvcGllZE5vZGUuaWQgPSBVVUlEVXRpbHMuZ2V0VVVJRCgpXHJcblx0XHRcdFx0Y29waWVkTm9kZXMucHVzaChjb3BpZWROb2RlKVxyXG5cdFx0XHR9XHJcblx0XHRcdGNvcGllZFNlY3Rpb24ubm9kZXMgPSBjb3BpZWROb2Rlc1xyXG5cdFx0XHRjb3BpZWRTZWN0aW9ucy5wdXNoKGNvcGllZFNlY3Rpb24pXHJcblx0XHR9XHJcblx0XHRjb25zdCBjb3BpZWRQaXBlbGluZTogUGlwZWxpbmVNb2RlbCA9IHtcclxuXHRcdFx0dGVtcGxhdGVUaXRsZTogdGVtcGxhdGUudGl0bGUsXHJcblx0XHRcdHRpdGxlOiB0YXNrTmFtZSxcclxuXHRcdFx0Y3JlYXRlVGltZTogRGF0ZS5ub3coKSxcclxuXHRcdFx0c3RhdHVzOiBOb2RlU3RhdHVzRW51bS5QRU5ESU5HLFxyXG5cdFx0XHRpc1RlbXBsYXRlOiBmYWxzZSxcclxuXHRcdFx0aWQ6IFVVSURVdGlscy5nZXRVVUlEKCksXHJcblx0XHRcdHN1YmplY3RJRDogc3ViamVjdD8uaWQgfHwgJzAnLFxyXG5cdFx0XHRzZWN0aW9uczogY29waWVkU2VjdGlvbnNcclxuXHRcdH1cclxuXHRcdHByb3BzLmNyZWF0ZU5ld1Rhc2soY29waWVkUGlwZWxpbmUpXHJcblx0fVxyXG5cclxuXHRjb25zdCBnZXRUZW1wbGF0ZVZpZXdzID0gKCkgPT4ge1xyXG5cdFx0bGV0IHBpcGVsaW5lcyA9IFtdXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRsZXQgcGlwZWxpbmUgPSB0ZW1wbGF0ZXNbaV1cclxuXHRcdFx0cGlwZWxpbmVzLnB1c2goXHJcblx0XHRcdFx0PE1lbnVJdGVtIGtleT17J3RlbXBsYXRlLScgKyBwaXBlbGluZS5pZH0gc3g9e3tjb2xvcjogJ3ZhcigtLXRleHQtbm9ybWFsKScsIGZvbnRTaXplOiAnMTNweCd9fSB2YWx1ZT17aX0+e3BpcGVsaW5lLnRpdGxlfTwvTWVudUl0ZW0+XHJcblx0XHRcdClcclxuXHRcdH1cclxuXHRcdHJldHVybiBwaXBlbGluZXNcclxuXHR9XHJcblxyXG5cdGNvbnN0IGhhbmRsZVRlbXBsYXRlQ2hhbmdlID0gKGV2ZW50OiBTZWxlY3RDaGFuZ2VFdmVudCkgPT4ge1xyXG5cdFx0c2V0VGVtcGxhdGVJbmRleChldmVudC50YXJnZXQudmFsdWUgYXMgc3RyaW5nKTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBnZXRTdWJqZWN0Vmlld3MgPSAoKSA9PiB7XHJcblx0XHRsZXQgc3ViamVjdHNWaWV3cyA9IFtdXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHN1YmplY3RzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGxldCBzdWJqZWN0ID0gc3ViamVjdHNbaV1cclxuXHRcdFx0c3ViamVjdHNWaWV3cy5wdXNoKFxyXG5cdFx0XHRcdDxNZW51SXRlbSBrZXk9eydzdWJqZWN0LScgKyBzdWJqZWN0LmlkfSBzeD17e2NvbG9yOiAndmFyKC0tdGV4dC1ub3JtYWwpJywgZm9udFNpemU6ICcxM3B4J319IHZhbHVlPXtpfT57c3ViamVjdC5uYW1lfTwvTWVudUl0ZW0+XHJcblx0XHRcdClcclxuXHRcdH1cclxuXHRcdHJldHVybiBzdWJqZWN0c1ZpZXdzXHJcblx0fVxyXG5cclxuXHRjb25zdCBoYW5kbGVTdWJqZWN0Q2hhbmdlID0gKGV2ZW50OiBTZWxlY3RDaGFuZ2VFdmVudCkgPT4ge1xyXG5cdFx0c2V0U3ViamVjdEluZGV4KGV2ZW50LnRhcmdldC52YWx1ZSBhcyBzdHJpbmcpO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IGhhbmRsZVRhc2tOYW1lQ2hhbmdlID0gKGV2ZW50OiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xyXG5cdFx0c2V0VGFza05hbWUoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuXHR9O1xyXG5cclxuXHRyZXR1cm4gKFxyXG5cdFx0PERpYWxvZyBvbkNsb3NlPXtjbG9zZURpYWxvZ30gb3Blbj17b3Blbn1cclxuXHRcdFx0XHRQYXBlclByb3BzPXt7XHJcblx0XHRcdFx0XHRzdHlsZToge1xyXG5cdFx0XHRcdFx0XHRiYWNrZ3JvdW5kQ29sb3I6ICd2YXIoLS1iYWNrZ3JvdW5kLXNlY29uZGFyeSknLFxyXG5cdFx0XHRcdFx0XHRib3hTaGFkb3c6ICdub25lJyxcclxuXHRcdFx0XHRcdFx0Y29sb3I6ICd2YXIoLS10ZXh0LW5vcm1hbCknXHJcblx0XHRcdFx0XHR9LFxyXG5cdFx0XHRcdH19PlxyXG5cdFx0XHQ8RGlhbG9nVGl0bGUgY2xhc3NOYW1lPXsnd29ya2Zsb3ctdGV4dC1ub3JtYWwnfT5cclxuXHRcdFx0XHRDcmVhdGUgYSBuZXcgcGlwZWxpbmVcclxuXHRcdFx0PC9EaWFsb2dUaXRsZT5cclxuXHRcdFx0PEZvcm1Db250cm9sIHZhcmlhbnQ9XCJzdGFuZGFyZFwiIHN4PXt7bWFyZ2luOjF9fT5cclxuXHRcdFx0XHQ8SW5wdXRMYWJlbCBpZD1cInRlbXBsYXRlLXNlbGVjdC1sYWJlbFwiIHN4PXt7Y29sb3I6ICd2YXIoLS10ZXh0LW5vcm1hbCknfX0+U2VsZWN0IHRlbXBsYXRlPC9JbnB1dExhYmVsPlxyXG5cdFx0XHRcdDxTZWxlY3RcclxuXHRcdFx0XHRcdHN0eWxlPXt7XHJcblx0XHRcdFx0XHRcdGNvbG9yOiAndmFyKC0tdGV4dC1ub3JtYWwpJyxcclxuXHRcdFx0XHRcdFx0Zm9udFNpemU6ICcxM3B4J1xyXG5cdFx0XHRcdFx0fX1cclxuXHRcdFx0XHRcdE1lbnVQcm9wcz17eyBQYXBlclByb3BzOiB7XHJcblx0XHRcdFx0XHRcdFx0c3g6IHtcclxuXHRcdFx0XHRcdFx0XHRcdGJhY2tncm91bmRDb2xvcjogJ3ZhcigtLWJhY2tncm91bmQtc2Vjb25kYXJ5KScsXHJcblx0XHRcdFx0XHRcdFx0XHRjb2xvcjogJyNGRkZGRkYnLFxyXG5cdFx0XHRcdFx0XHRcdH0sfSxcclxuXHRcdFx0XHRcdFx0fX1cclxuXHRcdFx0XHRcdGlkPVwidGVtcGxhdGUtc2VsZWN0XCJcclxuXHRcdFx0XHRcdHZhbHVlPXt0ZW1wbGF0ZUluZGV4fVxyXG5cdFx0XHRcdFx0b25DaGFuZ2U9e2hhbmRsZVRlbXBsYXRlQ2hhbmdlfVxyXG5cdFx0XHRcdD5cclxuXHRcdFx0XHRcdHtnZXRUZW1wbGF0ZVZpZXdzKCl9XHJcblx0XHRcdFx0PC9TZWxlY3Q+XHJcblx0XHRcdDwvRm9ybUNvbnRyb2w+XHJcblx0XHRcdDxGb3JtQ29udHJvbCB2YXJpYW50PVwic3RhbmRhcmRcIiBzeD17e21hcmdpbjoxfX0+XHJcblx0XHRcdFx0PElucHV0TGFiZWwgaWQ9XCJzdWJqZWN0LXNlbGVjdC1sYWJlbFwiIHN4PXt7Y29sb3I6ICd2YXIoLS10ZXh0LW5vcm1hbCknfX0+U2VsZWN0IHN1YmplY3Q8L0lucHV0TGFiZWw+XHJcblx0XHRcdFx0PFNlbGVjdFxyXG5cdFx0XHRcdFx0c3R5bGU9e3tcclxuXHRcdFx0XHRcdFx0Y29sb3I6ICd2YXIoLS10ZXh0LW5vcm1hbCknLFxyXG5cdFx0XHRcdFx0XHRmb250U2l6ZTogJzEzcHgnXHJcblx0XHRcdFx0XHR9fVxyXG5cdFx0XHRcdFx0TWVudVByb3BzPXt7IFBhcGVyUHJvcHM6IHtcclxuXHRcdFx0XHRcdFx0XHRzeDoge1xyXG5cdFx0XHRcdFx0XHRcdFx0YmFja2dyb3VuZENvbG9yOiAndmFyKC0tYmFja2dyb3VuZC1zZWNvbmRhcnkpJyxcclxuXHRcdFx0XHRcdFx0XHRcdGNvbG9yOiAnI0ZGRkZGRicsXHJcblx0XHRcdFx0XHRcdFx0fSx9LFxyXG5cdFx0XHRcdFx0fX1cclxuXHRcdFx0XHRcdGlkPVwic3ViamVjdC1zZWxlY3RcIlxyXG5cdFx0XHRcdFx0dmFsdWU9e3N1YmplY3RJbmRleH1cclxuXHRcdFx0XHRcdG9uQ2hhbmdlPXtoYW5kbGVTdWJqZWN0Q2hhbmdlfVxyXG5cdFx0XHRcdD5cclxuXHRcdFx0XHRcdHtnZXRTdWJqZWN0Vmlld3MoKX1cclxuXHRcdFx0XHQ8L1NlbGVjdD5cclxuXHRcdFx0PC9Gb3JtQ29udHJvbD5cclxuXHRcdFx0PEZvcm1Db250cm9sIHZhcmlhbnQ9XCJzdGFuZGFyZFwiIHN4PXt7bWFyZ2luOjF9fT5cclxuXHRcdFx0XHQ8aW5wdXQgY2xhc3NOYW1lPXsnd29ya2Zsb3ctaW5wdXQnfSBzdHlsZT17e2ZvbnRTaXplOiAnMTNweCd9fSBpZD1cInRlbXBsYXRlLXNpbXBsZVwiIHZhbHVlPXt0YXNrTmFtZX0gb25DaGFuZ2U9e2hhbmRsZVRhc2tOYW1lQ2hhbmdlfSAvPlxyXG5cdFx0XHRcdDxidXR0b25cclxuXHRcdFx0XHRcdHN0eWxlPXt7bWFyZ2luVG9wOiAxMH19XHJcblx0XHRcdFx0XHRvbkNsaWNrPXsoKSA9PiB7XHJcblx0XHRcdFx0XHRcdGhhbmRsZUNyZWF0ZU5ldygpXHJcblx0XHRcdFx0XHR9fVxyXG5cdFx0XHRcdFx0ZGlzYWJsZWQgPXt0ZW1wbGF0ZUluZGV4ID09PSAnJ31cclxuXHRcdFx0XHQ+XHJcblx0XHRcdFx0XHRPSyFcclxuXHRcdFx0XHQ8L2J1dHRvbj5cclxuXHRcdFx0PC9Gb3JtQ29udHJvbD5cclxuXHRcdDwvRGlhbG9nPlxyXG5cdCk7XHJcbn1cclxuIl19